!function(){'use strict';!function(c){let l=window.location.search.replace('?','').split('&').reduce((function(c,l){let e=l.split('=');return c[decodeURIComponent(e[0])]=decodeURIComponent(e[1]),c}),{}),e=c('.form-chat'),a=c('.chat-ul');c('.input-msg');function i(l,e){'В сети'===l.status?c('.sb-img > div > p').html(`<span style="color: #1967d2">${l.status}</span>`):c('.sb-img > div > p').html(l.status),a.html(l.list)}const s=function(c){const a=new EventSource(`/scripts/chat/?act=${c}&id=${l.id}&${e.serialize()}`);1===c?a.addEventListener('message',(c=>{let l=JSON.parse(c.data);'success'===l.code?i(l):console.log(l.code),a.close()}),{once:!0}):a.onmessage=function(c){let l=JSON.parse(c.data);'success'===l.code?i(l):console.log(l.code)}};s(2),c(document).on('click','.send-chat-y',(function(c){return c.preventDefault(),s(1),document.querySelector('.input-msg').value='',!1}));let t=c('.form-chat-list'),d=c('.chat-list-box');function n(c){console.log(c),d.html('<span class="chat-error">Ошибка, повторите</span>')}function o(){d.html('\n        <div class="placeholder-main">\n         <div class="placeholder-chat">\n                                    <div class="placeholder-item chat-img"></div>\n                                    <div class="placeholder-block-chat">\n                                        <div class="pc-flex">\n                                            <div class="placeholder-item chat-title"></div>\n                                            <div class="placeholder-item chat-litter-1"></div>\n                                        </div>\n                                        <div class="placeholder-item chat-little-2"></div>\n                                    </div>\n                                </div>\n                                 <div class="placeholder-chat">\n                                    <div class="placeholder-item chat-img"></div>\n                                    <div class="placeholder-block-chat">\n                                        <div class="pc-flex">\n                                            <div class="placeholder-item chat-title"></div>\n                                            <div class="placeholder-item chat-litter-1"></div>\n                                        </div>\n                                        <div class="placeholder-item chat-little-2"></div>\n                                    </div>\n                                </div>\n                                <div class="placeholder-chat">\n                                    <div class="placeholder-item chat-img"></div>\n                                    <div class="placeholder-block-chat">\n                                        <div class="pc-flex">\n                                            <div class="placeholder-item chat-title"></div>\n                                            <div class="placeholder-item chat-litter-1"></div>\n                                        </div>\n                                        <div class="placeholder-item chat-little-2"></div>\n                                    </div>\n                                </div>\n                                <div class="placeholder-chat">\n                                    <div class="placeholder-item chat-img"></div>\n                                    <div class="placeholder-block-chat">\n                                        <div class="pc-flex">\n                                            <div class="placeholder-item chat-title"></div>\n                                            <div class="placeholder-item chat-litter-1"></div>\n                                        </div>\n                                        <div class="placeholder-item chat-little-2"></div>\n                                    </div>\n                                </div>\n                                <div class="placeholder-chat">\n                                    <div class="placeholder-item chat-img"></div>\n                                    <div class="placeholder-block-chat">\n                                        <div class="pc-flex">\n                                            <div class="placeholder-item chat-title"></div>\n                                            <div class="placeholder-item chat-litter-1"></div>\n                                        </div>\n                                        <div class="placeholder-item chat-little-2"></div>\n                                    </div>\n                                </div>\n                                <div class="placeholder-chat">\n                                    <div class="placeholder-item chat-img"></div>\n                                    <div class="placeholder-block-chat">\n                                        <div class="pc-flex">\n                                            <div class="placeholder-item chat-title"></div>\n                                            <div class="placeholder-item chat-litter-1"></div>\n                                        </div>\n                                        <div class="placeholder-item chat-little-2"></div>\n                                    </div>\n                                </div>\n                                <div class="placeholder-chat">\n                                    <div class="placeholder-item chat-img"></div>\n                                    <div class="placeholder-block-chat">\n                                        <div class="pc-flex">\n                                            <div class="placeholder-item chat-title"></div>\n                                            <div class="placeholder-item chat-litter-1"></div>\n                                        </div>\n                                        <div class="placeholder-item chat-little-2"></div>\n                                    </div>\n                                </div>\n                                <div class="placeholder-chat">\n                                    <div class="placeholder-item chat-img"></div>\n                                    <div class="placeholder-block-chat">\n                                        <div class="pc-flex">\n                                            <div class="placeholder-item chat-title"></div>\n                                            <div class="placeholder-item chat-litter-1"></div>\n                                        </div>\n                                        <div class="placeholder-item chat-little-2"></div>\n                                    </div>\n                                </div>\n                                <div class="placeholder-chat">\n                                    <div class="placeholder-item chat-img"></div>\n                                    <div class="placeholder-block-chat">\n                                        <div class="pc-flex">\n                                            <div class="placeholder-item chat-title"></div>\n                                            <div class="placeholder-item chat-litter-1"></div>\n                                        </div>\n                                        <div class="placeholder-item chat-little-2"></div>\n                                    </div>\n                                </div>\n\n                            </div>'),c('.search-chat').attr('disabled','true'),setTimeout((function(){c.ajax({url:'/scripts/filter-chat',data:`id=${c('.lock-ses').val()}&${t.serialize()}`,type:'POST',cache:!0,dataType:'json',error:n,success:function(e){'success'===e.code?(c('.search-chat').removeAttr('disabled'),function(c){d.html('');let e=c.data.list,a=c.data.type;if(c.data.count>0)for(let c in e){let i=e[c];'users'==a?d.append(`\n                <li class="${Number(l.id)===i.id?'chat-act':''}">\n                                        <a href="/messages?id=${i.id}">\n                                            <div class="clist-img">\n                                        <span>\n                                            <img src="/static/image/company/${i.com_img}" alt="">\n                                        </span>\n                                            </div>\n                                            <div class="clist-content">\n                                                <div class="cl-top">\n                                        <span class="cl-name">\n                                        ${i.company.substr(0,30).replace(/(<([^>]+)>)/gi,'')}\n                                        <m>${i.lock_user||i.lock_company?'<i class="mdi mdi-cancel"></i>':''}</m>\n                                        </span>\n                                                    <span class="cl-time">\n                                            ${i.last}\n                                        </span>\n                                                </div>\n                                                <div class="cl-bot">\n                                                ${i.last_m.substr(0,30).replace(/(<([^>]+)>)/gi,'')}\n                                               \n                                                </div>\n                                            </div>\n                                        </a>\n                                    </li>\n                `):d.append(`\n                <li class="${Number(l.id)===i.id?'chat-act':''}">\n                                        <a href="/messages?id=${i.id}">\n                                            <div class="clist-img">\n                                        <span>\n                                            <img src="/static/image/users/${i.img}" alt="">\n                                        </span>\n                                            </div>\n                                            <div class="clist-content">\n                                                <div class="cl-top">\n                                        <span class="cl-name">\n                                        ${i.user}\n                                        <m>${i.lock_user||i.lock_company?'<i class="mdi mdi-cancel"></i>':''}</m>\n                                        </span>\n                                                    <span class="cl-time">\n                                            ${i.last}\n                                        </span>\n                                                </div>\n                                                <div class="cl-bot">\n                                                     ${i.last_m.substr(0,30).replace(/(<([^>]+)>)/gi,'')}\n                                                </div>\n                                            </div>\n                                        </a>\n                                    </li>\n                `)}else d.html('<span class="chat-error">Чаты не найдены</span>')}(e)):n(e)}})}),500)}c(document).on('click','.search-chat',(function(){o()})),o(),c('#upload-chat-photo').change((function(){if(void 0===window.FormData)alert('В вашем браузере загрузка файлов не поддерживается');else{let l=new FormData;c.each(c('#upload-chat-photo')[0].files,(function(c,e){l.append('file[]',e)})),c.ajax({type:'POST',url:'/scripts/uploads-js',cache:!1,contentType:!1,processData:!1,data:l,dataType:'json',success:function(l){l.forEach((function(l){''==l.error?(c('.image-box').fadeIn(200),c('.image-box').css('display','flex'),c('.image-box').append(l.data)):alert(l.error)})),c('.image-box').val('')}})}})),c(document).on('click','.lock-chat-go',(function(){c.ajax({url:'/scripts/profile-js',data:`id=${Number(l.id)}&MODULE_CHAT_LOCK=1`,type:'POST',cache:!1,dataType:'json',error:c=>console.log(c),success:function(c){'success'===c.code?location.reload():console.log(c)}})})),c(document).on('click','.unlock-chat-go',(function(){c.ajax({url:'/scripts/profile-js',data:`id=${Number(l.id)}&MODULE_CHAT_UNLOCK=1`,type:'POST',cache:!1,dataType:'json',error:c=>console.log(c),success:function(c){'success'===c.code?location.reload():console.log(c)}})}))}(jQuery)}();
